<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }
    #editor {
        margin: 0;
        position: absolute;
        top: 0;
        bottom: 0px;
        left: 0;
        right: 0;
    }
    #status-line {
      position: absolute;
      bottom: 0;
      right: 5px;
      height: 25px;
      z-index: 4;
      color: white;
      font: monospace;
      font-size: 13px;
    }
    #status-line span {
      padding-top: 3px;
      display: inline-block;
    }
  </style>
</head>
<body>

<pre id="editor">Hi, this is an interactive vim tutorial!
To begin, move the cursor to the star bellow using hjkl or the arrow keys,
and press x to delete it.

---> *</pre>
<div id="status-line">
<span>Keypresses:</span> <span id="keypresses">0</span>
</div>

<div style="display: none;">
<pre id="p0"></pre>
<pre id="t0"></pre>
<pre id="s0"></pre>

<pre id="p1">Hi, this is an interactive vim tutorial!
To begin, move the cursor to the star bellow using hjkl or the arrow keys,
and press x to delete it.

---> *</pre>
<pre id="t1">Hi, this is an interactive vim tutorial!
To begin, move the cursor to the star bellow using hjkl or the arrow keys,
and press x to delete it.

---> </pre>
<pre id="s1">G$x

G - Move the cursor to the bottom of the file
$ - Move the cursor to the end of the line
x - Delete the character under the cursor</pre>


<pre id="p2">Delete the star in * the middle of this sentence

You can press w to go to the next word, and b to go back again</pre>
<pre id="t2">Delete the star in  the middle of this sentence

You can press w to go to the next word, and b to go back again</pre>
<pre id="s2">f*x

f* - find *
x  - Delete the character under the cursor</pre>


<pre id="p3">The best editor is Emacs!

Oh no, someone made a typo!
Please correct it by changing "Emacs" to "Vim"

(You can enter text in insert mode. One way to get to insert mode is by pressing i. To leave insert mode, press Escape)</pre>
<pre id="t3">The best editor is Vim!

Oh no, someone made a typo!
Please correct it by changing "Emacs" to "Vim"

(You can enter text in insert mode. One way to get to insert mode is by pressing i. To leave insert mode, press Escape)</pre>
<pre id="s3">fEcwVim

fE - find E
cw - change word (remove the word under the cursor and enter insert mode)
Vim - Literally write "Vim" because we are in insert mode


PS: You could have used fEcwV<C-n> in real Vim, but that would have been really sneaky</pre>
</div>

<script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="src-noconflict/ext-language_tools.js"></script>
<script>
    ace.require("ace/ext/language_tools");

    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    /* editor.session.setMode("ace/mode/javascript"); */
    editor.setKeyboardHandler("ace/keyboard/vim");
    editor.setOptions({
        enableBasicAutocompletion: true
      , enableSnippets: false
      , enableLiveAutocompletion: false
    });
    editor.focus();

    var keyCount = 0;
    var userSol = "";
    var currentLevel = 1;
    var maxLevelSolved = 0;

    var tb = document.querySelector('.ace_text-input');
    var kp = document.querySelector('#keypresses');
    tb.addEventListener ('keydown', function (e) {
    if ( e.key == "Shift"
      || e.key == "Control"
      || e.key == "Alt"
      || e.key == "AltGraph"
      || e.key == "Meta") return;

      kp.innerText = ++keyCount;
      userSol += (e.controlDown? '^': '')
               + (e.key.length>1? '<'+e.key+'>': e.key);
    });

    var c = document.querySelector('.ace_content');
    c.addEventListener ('mousedown', function (e) {
      e.stopPropagation ();
      editor.focus();
      return false;
    });

    function showSolution (id) {
      var sel = document.getElementById("s"+id);
      editor.setValue ("Congratulations, you solved the level!\nYour solution: " + userSol + "\n\n\nBest known solution: " + sel.innerText + "\n\n\n:r to restart the level\n:n to go to the next one", 0);
      editor.selection.moveTo(0,0);
    }

    editor.on("change", function() {
      var sol = document.getElementById('t'+currentLevel).innerText;
      if (editor.getValue() != sol) return;
      showSolution(currentLevel);
      maxLevelSolved = currentLevel;
    });

    function resetLevel () {
      keyCount = 0;
      kp.innerText = 0;
      userSol = "";
      editor.setValue(document.getElementById('p'+currentLevel).innerText);
      editor.selection.moveTo(0,0);
    }

    function nextLevel () {
      if (currentLevel>maxLevelSolved) return;
      keyCount = 0;
      kp.innerText = 0;
      userSol = "";
      currentLevel++;
      editor.setValue(document.getElementById('p'+currentLevel).innerText);
      editor.selection.moveTo(0,0);
    }

    ace.config.loadModule("ace/keyboard/vim", function(m) {
        var VimApi = ace.require("ace/keyboard/vim").CodeMirror.Vim
        VimApi.defineEx("restart", "r", function(cm, input) {
            //cm.ace.execCommand("save")
            resetLevel();
        });
        VimApi.defineEx("next", "n", function(cm, input) {
            nextLevel();
        });
    });
</script>

</body>
</html>
